{% extends 'students/base.html' %}

{% block content %}
    <div class="card">
        <h1>Pending Fees</h1>
        {% if pending_students %}
            <ul>
                {% for item in pending_students %}
                    <li>
                        <i class="fas fa-user-clock"></i>
                        <div class="student-info">
                            <a href="{% url 'student_detail' item.student.roll_number %}">
                                {{ item.student.name }} (Roll No: {{ item.student.roll_number }})
                            </a>
                            <small>Fees pending since: {{ item.student.paid_till_date|default:"N/A" }}</small><br>
                            <small>Pending Periods: {{ item.pending_periods }} months</small><br>
                            <small>Total Pending: ₹{{ item.pending_amount }}</small>
                        </div>
                        {% with whatsapp_message="Dear "|add:item.student.name|add:", your fees are pending for "|add:item.pending_periods|stringformat:"s"|add:" months, totaling ₹"|add:item.pending_amount|stringformat:"s"|add:". Please pay as soon as possible. Thank you." %}
                        <a href="https://wa.me/{{ item.student.phone_number }}?text={{ whatsapp_message|urlencode }}" class="whatsapp-button" target="_blank">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </a>
                        {% endwith %}
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No students with pending fees.</p>
        {% endif %}
    </div>
{% endblock content %}